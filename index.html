<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperos MaPe</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --soft-pink: #F9EAE1;
            --sage-green: #D4E2D4;
            --deep-taupe: #7D6B5D;
            --cream: #FFFBFA;
            --accent: #E8B4B8;
        }

        body { font-family: 'Poppins', sans-serif; background-color: var(--cream); color: var(--deep-taupe); margin: 0; padding-bottom: 20px; }
        header { background-color: var(--soft-pink); padding: 25px 15px; text-align: center; border-bottom: 3px solid var(--accent); }
        h1 { font-family: 'Playfair Display', serif; margin: 0; }
        
        .nav-tabs { display: flex; background: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; font-weight: 600; color: #A0A0A0; cursor: pointer; }
        .tab-btn.active { color: var(--deep-taupe); border-bottom: 4px solid var(--accent); }

        .container { padding: 20px; max-width: 600px; margin: auto; }
        .card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--soft-pink); box-shadow: 0 4px 6px rgba(0,0,0,0.02); cursor: pointer; }
        .recipe-img-card { width: 100%; border-radius: 10px; height: 180px; object-fit: cover; margin-bottom: 10px; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--soft-pink); border-radius: 10px; box-sizing: border-box; font-family: inherit; }
        .btn-main { background-color: var(--sage-green); color: #4A5D4A; border: none; padding: 12px; border-radius: 25px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-sec { background: none; border: 1px solid var(--accent); color: var(--deep-taupe); padding: 8px; border-radius: 10px; cursor: pointer; margin-top: 5px; width: 100%; }
        
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: white; z-index: 1000; overflow-y: auto; display: none; }
        .img-preview { width: 100%; height: 200px; object-fit: cover; border-radius: 15px; margin-bottom: 10px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border: 2px dashed var(--soft-pink); }
        
        .badge { padding: 12px; border-radius: 15px; font-weight: bold; display: block; text-align: center; margin-top: 20px; }
        .available { background: #E2F3E2; color: #2E7D32; border: 1px solid #C8E6C9; }
        .missing { background: #FFEBEE; color: #C62828; border: 1px solid #FFCDD2; }

        .item-row { display: flex; gap: 8px; align-items: center; background: #fdfdfd; padding: 10px; border-radius: 10px; margin-bottom: 5px; border: 1px solid #f0f0f0; }
        .del-btn { color: #E57373; cursor: pointer; font-weight: bold; border: none; background: none; padding: 5px; font-size: 1.2rem; }
        
        ul, ol { padding-left: 20px; }
        li { margin-bottom: 8px; }
    </style>
</head>
<body>

<header><h1>Temperos MaPe</h1></header>

<div class="nav-tabs">
    <button class="tab-btn active" id="btn-tab-rec" onclick="showTab('receitas')">Receitas</button>
    <button class="tab-btn" id="btn-tab-est" onclick="showTab('estoque')">Estoque</button>
</div>

<div id="receitas" class="container">
    <button class="btn-main" onclick="abrirModal('modal-receita')">+ Nova Receita</button>
    <div id="lista-receitas" style="margin-top:20px"></div>
</div>

<div id="estoque" class="container" style="display:none">
    <button class="btn-main" onclick="abrirModal('modal-estoque')">+ Adicionar Item ao Estoque</button>
    <div id="lista-estoque" style="margin-top:20px"></div>
</div>

<div id="modal-estoque" class="modal">
    <div class="container">
        <h3>Novo Item no Estoque</h3>
        <input type="text" id="est-nome" placeholder="Nome do item (ex: alho)">
        
        <label style="font-size: 0.8rem;">Foto do Produto:</label>
        <input type="file" id="est-file" accept="image/*" onchange="previewImg(this, 'preview-est')">
        <div id="preview-est" class="img-preview">Toque para selecionar foto</div>

        <input type="number" id="est-qtd" placeholder="Quantidade dispon√≠vel">
        
        <select id="est-un" onchange="checkOutro(this, 'div-outro-est')">
            <option value="unidade(s)">unidade(s)</option>
            <option value="grama(s) (g)">grama(s) (g)</option>
            <option value="quilo(s) (kg)">quilo(s) (kg)</option>
            <option value="mililitro(s) (ml)">mililitro(s) (ml)</option>
            <option value="colher(es)">colher(es)</option>
            <option value="Outro">Outro...</option>
        </select>
        <div id="div-outro-est" style="display:none">
            <input type="text" id="est-un-outro" placeholder="Ex: dente, x√≠cara...">
        </div>

        <button class="btn-main" onclick="salvarEstoque()">Confirmar Estoque</button>
        <button class="btn-sec" onclick="fecharModais()">Voltar</button>
    </div>
</div>

<div id="modal-receita" class="modal">
    <div class="container">
        <h3>Cadastrar Receita</h3>
        <input type="text" id="rec-nome" placeholder="Nome da Receita">
        
        <label style="font-size: 0.8rem;">Foto do Prato Pronto:</label>
        <input type="file" id="rec-file" accept="image/*" onchange="previewImg(this, 'preview-rec')">
        <div id="preview-rec" class="img-preview">Toque para selecionar foto</div>

        <select id="rec-cat">
            <option value="Comidas">Comidas</option>
            <option value="Lanches">Lanches</option>
            <option value="Sobremesas">Sobremesas</option>
            <option value="Outro" onchange="checkOutro(this, 'div-outro-cat')">Outro...</option>
        </select>
        <div id="div-outro-cat" style="display:none">
            <input type="text" id="rec-cat-outro" placeholder="Qual categoria?">
        </div>

        <h4>Ingredientes necess√°rios</h4>
        <p style="font-size: 0.7rem; color: #888;">*Apenas itens cadastrados no estoque aparecem aqui.</p>
        <div id="area-ingredientes"></div>
        <button class="btn-sec" onclick="addLinhaIngrediente()">+ Adicionar Ingrediente</button>

        <h4>Modo de Preparo</h4>
        <div id="area-passos">
            <textarea class="passo-txt" placeholder="Passo 1: Descreva o que fazer..."></textarea>
        </div>
        <button class="btn-sec" onclick="addLinhaPasso()">+ Adicionar Pr√≥ximo Passo</button>

        <button class="btn-main" onclick="salvarReceita()" style="margin-top: 30px;">Salvar no Caderno</button>
        <button class="btn-sec" onclick="fecharModais()">Cancelar</button>
    </div>
</div>

<div id="modal-detalhe" class="modal">
    <div id="conteudo-detalhe" class="container"></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('mape_v3')) || { estoque: [], receitas: [] };
    let tempImg = "";

    function showTab(tab) {
        document.getElementById('estoque').style.display = tab === 'estoque' ? 'block' : 'none';
        document.getElementById('receitas').style.display = tab === 'receitas' ? 'block' : 'none';
        document.getElementById('btn-tab-est').classList.toggle('active', tab === 'estoque');
        document.getElementById('btn-tab-rec').classList.toggle('active', tab === 'receitas');
        render();
    }

    function abrirModal(id) { 
        document.getElementById(id).style.display = 'block'; 
        if(id === 'modal-receita') {
            document.getElementById('area-ingredientes').innerHTML = '';
            addLinhaIngrediente();
        }
    }
    
    function fecharModais() { 
        document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); 
        tempImg = "";
        document.querySelectorAll('.img-preview').forEach(p => p.innerHTML = "Toque para selecionar foto");
        document.querySelectorAll('input, textarea').forEach(i => i.value = '');
    }

    function checkOutro(sel, divId) {
        document.getElementById(divId).style.display = sel.value === 'Outro' ? 'block' : 'none';
    }

    function previewImg(input, previewId) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onloadend = function() {
            tempImg = reader.result;
            document.getElementById(previewId).innerHTML = `<img src="${tempImg}" style="width:100%; height:100%; object-fit:cover; border-radius:15px">`;
        }
        if (file) reader.readAsDataURL(file);
    }

    function salvarEstoque() {
        const nome = document.getElementById('est-nome').value.toLowerCase().trim();
        const unBase = document.getElementById('est-un').value;
        const unidade = unBase === 'Outro' ? document.getElementById('est-un-outro').value : unBase;
        
        if(!nome) return alert("Por favor, digite o nome do item.");

        db.estoque.push({
            id: Date.now(),
            nome: nome,
            qtd: parseFloat(document.getElementById('est-qtd').value) || 0,
            unidade: unidade,
            foto: tempImg
        });
        save();
        fecharModais();
    }

    function addLinhaIngrediente() {
        const div = document.createElement('div');
        div.className = 'item-row';
        let options = db.estoque.map(i => `<option value="${i.nome}">${i.nome}</option>`).join('');
        div.innerHTML = `
            <select class="ing-sel" style="margin:0; flex: 2;">${options ? options : '<option>Cadastre itens no estoque primeiro!</option>'}</select>
            <input type="number" class="ing-qtd" placeholder="Qtd" style="width:70px; margin:0; flex: 1;">
            <span class="del-btn" onclick="this.parentElement.remove()">√ó</span>
        `;
        document.getElementById('area-ingredientes').appendChild(div);
    }

    function addLinhaPasso() {
        const t = document.createElement('textarea');
        t.className = 'passo-txt';
        t.placeholder = "Descreva o pr√≥ximo passo...";
        document.getElementById('area-passos').appendChild(t);
    }

    function salvarReceita() {
        const nome = document.getElementById('rec-nome').value.trim();
        const catBase = document.getElementById('rec-cat').value;
        const categoria = catBase === 'Outro' ? document.getElementById('rec-cat-outro').value : catBase;

        if(!nome) return alert("A receita precisa de um nome!");

        const ings = Array.from(document.querySelectorAll('#area-ingredientes .item-row')).map(row => ({
            nome: row.querySelector('.ing-sel').value,
            qtd: parseFloat(row.querySelector('.ing-qtd').value) || 0
        })).filter(i => i.nome);

        const passos = Array.from(document.querySelectorAll('.passo-txt')).map(i => i.value).filter(v => v);

        db.receitas.push({
            id: Date.now(),
            nome,
            categoria,
            foto: tempImg,
            ingredientes: ings,
            passos: passos
        });
        save();
        fecharModais();
    }

    function verReceita(id) {
        const r = db.receitas.find(x => x.id === id);
        let falta = [];
        
        r.ingredientes.forEach(ing => {
            const est = db.estoque.find(e => e.nome === ing.nome);
            if(!est || est.qtd < ing.qtd) {
                const qtdFaltante = est ? (ing.qtd - est.qtd) : ing.qtd;
                falta.push(`${ing.nome}`);
            }
        });

        const statusHtml = falta.length === 0 
            ? `<div class="badge available">‚úì Temos tudo no estoque!<br>M√£os √† obra!</div>`
            : `<div class="badge missing">‚úó Falta no estoque para esta receita:<br>${falta.join(', ')}</div>`;

        document.getElementById('conteudo-detalhe').innerHTML = `
            <button class="btn-sec" onclick="fecharModais()" style="width:auto; margin-bottom: 15px;">‚Üê Voltar para a lista</button>
            <h2 style="font-family:'Playfair Display'; margin-bottom: 5px;">${r.nome}</h2>
            <small style="color: var(--accent); display:block; margin-bottom: 15px;">Categoria: ${r.categoria}</small>
            
            ${r.foto ? `<img src="${r.foto}" style="width:100%; border-radius:15px; margin-bottom:20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1)">` : ''}
            
            <div style="background: white; padding: 15px; border-radius: 15px; border: 1px solid var(--soft-pink); margin-bottom: 20px;">
                <h4 style="margin-top:0">Ingredientes:</h4>
                <ul>${r.ingredientes.map(i => `<li><b>${i.qtd}</b> de ${i.nome}</li>`).join('')}</ul>
            </div>

            <div style="background: white; padding: 15px; border-radius: 15px; border: 1px solid var(--soft-pink);">
                <h4 style="margin-top:0">Modo de Preparo:</h4>
                <ol>${r.passos.map(p => `<li style="margin-bottom:12px">${p}</li>`).join('')}</ol>
            </div>

            ${statusHtml}
            
            <button class="btn-sec" onclick="removerItem('receitas', ${r.id})" style="color:#E57373; margin-top:40px; border-color:#FFEBEE; font-size: 0.8rem;">Apagar esta receita para sempre</button>
        `;
        abrirModal('modal-detalhe');
    }

    function removerItem(tipo, id) {
        if(confirm("Tem certeza que deseja remover este item?")) {
            db[tipo] = db[tipo].filter(x => x.id !== id);
            save();
            fecharModais();
        }
    }

    function save() {
        localStorage.setItem('mape_v3', JSON.stringify(db));
        render();
    }

    function render() {
        // Render Estoque
        const estDiv = document.getElementById('lista-estoque');
        estDiv.innerHTML = db.estoque.length ? db.estoque.map(i => `
            <div class="card" style="display:flex; align-items:center; gap:15px; cursor: default;">
                <img src="${i.foto || 'https://via.placeholder.com/50'}" style="width:60px; height:60px; border-radius:12px; object-fit:cover; background: #eee;">
                <div style="flex:1"><b>${i.nome.charAt(0).toUpperCase() + i.nome.slice(1)}</b><br><small style="color: #888;">${i.qtd} ${i.unidade}</small></div>
                <button class="del-btn" onclick="removerItem('estoque', ${i.id})">üóë</button>
            </div>
        `).join('') : '<p style="text-align:center; color:#999; margin-top:40px;">O estoque est√° vazio. Comece adicionando o que voc√™ tem em casa!</p>';

        // Render Receitas
        const recDiv = document.getElementById('lista-receitas');
        recDiv.innerHTML = db.receitas.length ? db.receitas.map(r => `
            <div class="card" onclick="verReceita(${r.id})">
                ${r.foto ? `<img src="${r.foto}" class="recipe-img-card">` : ''}
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <b style="font-size: 1.1rem;">${r.nome}</b>
                    <small style="background: var(--soft-pink); padding: 2px 8px; border-radius: 10px; font-size: 0.7rem;">${r.categoria}</small>
                </div>
            </div>
        `).join('') : '<p style="text-align:center; color:#999; margin-top:40px;">Nenhuma receita por aqui ainda. Que tal cadastrar a primeira?</p>';
    }

    // Inicializa√ß√£o
    window.onload = () => {
        showTab('receitas'); // For√ßa abrir em receitas
    };
</script>

</body>
</html>
